{% extends "snapp/base.html" %}

{% block head %}
    <script type="text/javascript">

        function saveDraft() {
            var formData = $('#awesome > p > :input').serializeArray();
            localStorage[document.URL] = JSON.stringify(formData);
            showAlertTemporarily();
        }

        var populateWithLocalData = function () {
            var draftData = JSON.parse(localStorage.getItem(document.URL));

            $('#awesome > p > :input').each(function (inputIdx, inputField) {
                $(draftData).each(function (draftDataIdx, draftDataField) {
                    for (idx in draftData) {
                        if (inputField.name === draftDataField.name) {
                            if (inputField.type === "checkbox") {
                                $(inputField).prop('checked', true);
                            }
                            inputField.value = draftDataField.value;
                        }
                    }
                });
            });
        };

        // todo: any sensitive data?
        // todo: dont notify if save failed due to invalid data

        $(document).ready(function () {

            $('#awesome > p > :input').focusout(function () {
                saveDraft();
            })

            populateWithLocalData();

            $(".alert").hide();
            $(".alert").alert();
        });
    </script>
{% endblock %}
{% block content %}

    <h1>{{ form.title }}</h1>
    <div class="alert alert-success fade in"></div>
    {% if form.intro %}
        <p>{{ form.intro }}</p>
    {% endif %}

    <form id="awesome" action="{{ form.get_absolute_url }}" method="post"
          {% if form_for_form.is_multipart %}enctype="multipart/form-data"{% endif %}>
        {% csrf_token %}
        {{ form_for_form.as_p }}
        <div style="clear:left;">&nbsp;</div>
        <input type="submit" value="{{ form.button_text }}">
    </form>
{% endblock %}
